import { useState, useEffect, useRef } from "react";
import mapboxgl from "mapbox-gl";
import Head from "next/head";
import styles from "../styles/components/Map.module.css";

mapboxgl.accessToken =
  "pk.eyJ1IjoibWlzaGFuOTk1IiwiYSI6ImNrbDAxbjJicDBlc2Eybm1pdjYyMGM2eXQifQ.BjGEzQ-RZfFOCMEp7dXPgg";

const MapboxGLMap = () => {
  const mapContainerRef = useRef(null);

  const [lng, setLng] = useState(-122.2056);
  const [lat, setLat] = useState(47.5736);
  const [zoom, setZoom] = useState(11);

  //Initialize map when component mounts
  useEffect(() => {
    const map = new mapboxgl.Map({
      container: mapContainerRef.current,
      style: "mapbox://styles/mapbox/streets-v11",
      center: [lng, lat],
      zoom: zoom,
    });

    //Add navigation control (the +/- zoom buttons)
    map.addControl(new mapboxgl.NavigationControl());

    map.on("move", () => {
      setLng(map.getCenter().lng.toFixed(4));
      setLat(map.getCenter().lat.toFixed(4));
      setZoom(map.getZoom().toFixed(2));
    });

    // Add a GeoJSON Line
    map.on("load", () => {
      map.addSource("route", {
        type: "geojson",
        data: {
          type: "Feature",
          properties: {},
          geometry: {
            type: "LineString",
            coordinates: [
              [-122.297428, 47.589901],
              [-122.295927, 47.590575],
              [-122.288887, 47.590415],
              [-122.288445, 47.590977],
              [-122.287718, 47.590499],
              [-122.285844, 47.59042],
              [-122.253838, 47.589789],
              [-122.250217, 47.590732],
              [-122.247854, 47.590306],
              [-122.2468, 47.591271],
              [-122.243185, 47.591822],
              [-122.235612, 47.588203],
              [-122.232168, 47.586813],
              [-122.230121, 47.586634],
              [-122.229382, 47.587235],
              [-122.227681, 47.586627],
              [-122.213093, 47.579214],
              [-122.207177, 47.578609],
              [-122.207244, 47.57747],
              [-122.205868, 47.576336],
              [-122.205589, 47.573591],
              [-122.20588, 47.572503],
              [-122.208733, 47.570792],
              [-122.211655, 47.568014],
              [-122.211351, 47.566931],
              [-122.21257, 47.566493],
              [-122.211524, 47.56608],
              [-122.211621, 47.565571],
              [-122.213581, 47.565208],
              [-122.211628, 47.564137],
              [-122.212018, 47.562596],
              [-122.212965, 47.562116],
              [-122.212662, 47.560256],
              [-122.214156, 47.559779],
              [-122.213005, 47.558675],
              [-122.212965, 47.557414],
              [-122.21358, 47.557149],
              [-122.213434, 47.55656],
              [-122.214858, 47.556124],
              [-122.213353, 47.555718],
              [-122.21355, 47.554873],
              [-122.212688, 47.554663],
              [-122.213259, 47.554028],
              [-122.212572, 47.553564],
              [-122.212762, 47.552332],
              [-122.214096, 47.552053],
              [-122.212559, 47.551355],
              [-122.212996, 47.550717],
              [-122.212111, 47.545109],
              [-122.215045, 47.544961],
              [-122.212822, 47.543488],
              [-122.212809, 47.537163],
              [-122.214474, 47.534891],
              [-122.220193, 47.530693],
              [-122.220517, 47.529206],
              [-122.222682, 47.528311],
              [-122.225904, 47.527987],
              [-122.225999, 47.526646],
              [-122.226804, 47.525969],
              [-122.229089, 47.526809],
              [-122.233492, 47.529762],
              [-122.23765, 47.531012],
              [-122.239135, 47.532778],
              [-122.239126, 47.533858],
              [-122.240747, 47.535166],
              [-122.239225, 47.537905],
              [-122.234571, 47.541231],
              [-122.233743, 47.544469],
              [-122.231398, 47.546839],
              [-122.230591, 47.550932],
              [-122.229471, 47.551706],
              [-122.229165, 47.554814],
              [-122.225908, 47.555654],
              [-122.224728, 47.557472],
              [-122.225844, 47.558179],
              [-122.226111, 47.559629],
              [-122.227545, 47.560769],
              [-122.228149, 47.565292],
              [-122.229052, 47.566128],
              [-122.228673, 47.568076],
              [-122.229589, 47.56887],
              [-122.229781, 47.570137],
              [-122.232486, 47.570758],
              [-122.233336, 47.572175],
              [-122.237746, 47.573202],
              [-122.240793, 47.575458],
              [-122.244541, 47.57714],
              [-122.248455, 47.580475],
              [-122.248534, 47.581863],
              [-122.250915, 47.581899],
              [-122.252999, 47.587385],
              [-122.253009, 47.590053],
              [-122.252108, 47.590364],
              [-122.253374, 47.589818],
              [-122.257889, 47.589818],
              [-122.285844, 47.59042],
              [-122.287718, 47.590499],
              [-122.288445, 47.590977],
              [-122.288887, 47.590415],
              [-122.295927, 47.590575],
              [-122.297428, 47.589901],
            ],
          },
        },
      });
      map.addLayer({
        id: "route",
        type: "line",
        source: "route",
        layout: {
          "line-join": "round",
          "line-cap": "round",
        },
        paint: {
          "line-color": "#fc6100",
          "line-width": 6,
        },
      });
    });

    //Clean up on unmount
    return () => map.remove();
  }, []);

  return (
    <div>
      <Head>
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
        <link
          href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"
          rel="stylesheet"
        />
      </Head>
      <div>
        Longitude: {lng} | Latitude: {lat} | Zoom: {zoom}
      </div>
      <div className={styles.mapContainer} ref={mapContainerRef}></div>
    </div>
  );
};

export default MapboxGLMap;
